<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard · Best Sellers</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/css.css">
  <style>
    canvas{ width: 100% !important; height: 360px !important; }
  </style>
</head>
<body>
  <nav class="fixed left-0 top-0 z-50 w-full border-b border-brand-line/70 bg-brand-paper/80 backdrop-blur-xl">
    <div class="mx-auto flex w-full max-w-7xl flex-nowrap items-center justify-between gap-4 px-5 py-5 md:px-10">
      <a href="html.html" class="group inline-flex items-center gap-2 font-display text-xl font-bold tracking-tight text-brand-bronze">
        <span class="relative">
          dar lbenna
          <span class="pointer-events-none absolute -bottom-1 left-0 h-px w-0 bg-brand-accent/80 transition-all duration-500 group-hover:w-full"></span>
        </span>
        <span class="text-sm text-brand-accent">★</span>
      </a>

      <div class="hidden flex-1 items-center justify-center md:flex">
        <div class="flex w-full max-w-2xl items-center justify-center gap-6">
          <a href="html.html" class="relative whitespace-nowrap text-sm tracking-wide text-brand-ink/90 transition-colors duration-300 hover:text-brand-primary">Retour accueil</a>
          <span class="h-px w-10 bg-brand-line/80"></span>
          <span class="relative whitespace-nowrap text-sm font-semibold tracking-wide text-brand-ink/90">Dashboard · Best Sellers</span>
        </div>
      </div>

      <div class="flex shrink-0 flex-nowrap items-center gap-3" data-auth-allow>
        <div id="graphUserBadge" class="flex flex-nowrap items-center gap-3 md:flex">
          <button type="button" class="ui-pill rounded-full" data-auth-allow>
            <div class="ui-avatar" data-auth-allow>DT</div>
            <div class="ui-identity hidden md:block" data-auth-allow>
              <div id="graphUserName" class="ui-name text-sm" data-auth-allow>Admin</div>
              <div class="ui-sub" data-auth-allow>Connecté</div>
            </div>
          </button>
          <button id="graphLogoutBtn" type="button" class="ui-pill ui-pill-danger whitespace-nowrap rounded-full text-xs font-semibold uppercase tracking-[0.22em]">
            Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <main class="mt-[110px] bg-brand-paper pb-16">
    <div class="mx-auto w-full max-w-7xl px-5 md:px-10">
      <div class="flex flex-col gap-4 border border-brand-line/70 bg-white p-6 shadow-soft md:flex-row md:items-end md:justify-between">
        <div>
          <div class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-muted">Admin dashboard</div>
          <h1 class="mt-3 font-display text-4xl font-bold tracking-tight text-brand-ink">Best-selling products</h1>
          <p class="mt-3 max-w-2xl text-sm leading-relaxed text-brand-muted">Le graphe se met à jour automatiquement à partir des commandes enregistrées dans le navigateur.</p>
        </div>
        <div class="inline-flex items-center gap-3 border border-brand-line/80 bg-brand-cream px-4 py-3 text-xs font-semibold uppercase tracking-[0.22em] text-brand-ink">
          <span class="inline-flex h-2 w-2 rounded-full bg-green-500"></span>
          <span>Live</span>
          <span id="lastUpdate">—</span>
        </div>
      </div>

      <div class="mt-8 grid gap-6 lg:grid-cols-3">
        <section class="border border-brand-line/70 bg-white p-6 shadow-soft lg:col-span-2">
          <div class="flex flex-col gap-2">
            <div class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-muted">Ventes par produit</div>
            <div class="text-sm text-brand-muted">Axes : Produit (X) · Nombre de commandes (Y)</div>
          </div>
          <div class="mt-6">
            <canvas id="salesChart" aria-label="Graph des meilleures ventes" role="img"></canvas>
          </div>
          <div class="mt-4 text-xs text-brand-muted">
            Clé(s) supportée(s) : <code>orders</code>, <code>dt_orders</code>, et toutes les clés <code>dt_orders_*</code>.
          </div>
        </section>

        <aside class="border border-brand-line/70 bg-white p-6 shadow-soft">
          <div class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-muted">Best Seller</div>
          <div class="mt-4 border border-brand-line/70 bg-brand-cream p-5">
            <div class="flex flex-wrap items-center gap-2">
              <div id="bestName" class="font-display text-2xl font-bold tracking-tight text-brand-ink">—</div>
              <span id="bestBadge" class="hidden border border-brand-accent/30 bg-white px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-ink">Best Seller</span>
            </div>
            <div id="bestStats" class="mt-3 text-sm text-brand-muted">Aucune commande trouvée.</div>
          </div>

          <div class="mt-5 grid grid-cols-2 gap-3">
            <div class="border border-brand-line/70 bg-white px-4 py-4">
              <div class="text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-muted">Total produits</div>
              <div id="kpiProducts" class="mt-2 text-xl font-bold text-brand-ink">0</div>
            </div>
            <div class="border border-brand-line/70 bg-white px-4 py-4">
              <div class="text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-muted">Total commandes</div>
              <div id="kpiOrders" class="mt-2 text-xl font-bold text-brand-ink">0</div>
            </div>
          </div>

          <div class="mt-5 text-xs leading-relaxed text-brand-muted">
            Le best seller est aussi mis en évidence sur le graphe (couleur différente) et les barres sont animées.
          </div>
        </aside>
      </div>

      <div class="mt-8 grid gap-6 lg:grid-cols-3">
        <section class="border border-brand-line/70 bg-white p-6 shadow-soft lg:col-span-2">
          <div class="flex flex-col gap-2">
            <div class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-muted">Notes utilisateurs (1–5)</div>
            <div class="text-sm text-brand-muted">Axes : Produit (X) · Note moyenne (Y)</div>
          </div>
          <div class="mt-6">
            <canvas id="ratingsAdminChart" aria-label="Graph des notes produits" role="img"></canvas>
          </div>
          <div class="mt-4 text-xs text-brand-muted">
            Sources : toutes les clés <code>dt_product_ratings_*</code> (par utilisateur).
          </div>
        </section>

        <aside class="border border-brand-line/70 bg-white p-6 shadow-soft">
          <div class="text-xs font-semibold uppercase tracking-[0.28em] text-brand-muted">Qualité globale</div>
          <div class="mt-4 border border-brand-line/70 bg-brand-cream p-5">
            <div class="flex flex-wrap items-center gap-2">
              <div id="bestRatedName" class="font-display text-2xl font-bold tracking-tight text-brand-ink">—</div>
              <span id="bestRatedBadge" class="hidden border border-brand-accent/30 bg-white px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-ink">Top rated</span>
            </div>
            <div id="bestRatedStats" class="mt-3 text-sm text-brand-muted">Aucune note trouvée.</div>
          </div>

          <div class="mt-5 grid grid-cols-2 gap-3">
            <div class="border border-brand-line/70 bg-white px-4 py-4">
              <div class="text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-muted">Produits notés</div>
              <div id="kpiRatedProducts" class="mt-2 text-xl font-bold text-brand-ink">0</div>
            </div>
            <div class="border border-brand-line/70 bg-white px-4 py-4">
              <div class="text-[11px] font-semibold uppercase tracking-[0.22em] text-brand-muted">Total votes</div>
              <div id="kpiTotalVotes" class="mt-2 text-xl font-bold text-brand-ink">0</div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="../javascript/graphe.js"></script>
  <script src="../javascript/lang.js"></script>
</body>
</html>
